[gcode_macro CANCEL_PRINT]
rename_existing: BASE_CANCEL_PRINT
gcode:
    TURN_OFF_HEATERS
    SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
    SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
    SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
    SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=0
    BASE_CANCEL_PRINT



[gcode_macro RESUME_MACRO]
gcode:
   M117 RESUMING...
   G92 E0
   G1 E20 F100
   G92 E0
   G1 E80 F500
   G92 E0
   M117 Printing...
   RESUME
   RESTORE_GCODE_STATE NAME=SAVESTATE MOVE=1


[pause_resume]
recover_velocity: 50.0

[gcode_macro M600]
gcode:
    SAVE_GCODE_STATE NAME=M600_state
    PAUSE
    G91
    G1 E-.8 F2700
    G1 Z10
    G90
    G1 X50 Y0 F3000
    G91
    G1 E-50 F1000
    RESTORE_GCODE_STATE NAME=M600_state


[gcode_macro filament_out_190]
gcode:
    filament_out EXTRUDER_TEMP=190

[gcode_macro filament_out_220]
gcode:
    filament_out EXTRUDER_TEMP=220

[gcode_macro filament_out]
gcode:
    SAVE_GCODE_STATE NAME=__filament__load
    {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|float %}
    {% if printer.extruder.temperature < EXTRUDER_TEMP %}
        M109 S{EXTRUDER_TEMP}
    {% endif %}
    M83
    G1 E-80 F500
    RESTORE_GCODE_STATE NAME=__filament__load

[gcode_macro filament_load_200]
gcode:
    filament_load EXTRUDER_TEMP=200

[gcode_macro filament_load_230]
gcode:
    filament_load EXTRUDER_TEMP=230

[gcode_macro filament_load]
gcode:
    SAVE_GCODE_STATE NAME=__filament__load
    {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|float %}
    {% if printer.extruder.temperature < EXTRUDER_TEMP %}
        M109 S{EXTRUDER_TEMP}
    {% endif %}
    M83
    G1 E50 F960
    G1 E25 F240
    G1 E-5 F240
    RESTORE_GCODE_STATE NAME=__filament__load

[gcode_macro flex_filament_load_220]
gcode:
    SAVE_GCODE_STATE NAME=__filament__load
    {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
    {% if printer.extruder.temperature < EXTRUDER_TEMP %}
        M109 S{EXTRUDER_TEMP}
    {% endif %}
    M83
    G1 E50 F80
    G1 E30 F80
    G1 E-5 F80
    RESTORE_GCODE_STATE NAME=__filament__load

[gcode_macro START_PRINT]
gcode:
    {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
    {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(190)|float %}
    M104 S{EXTRUDER_TEMP} ; set extruder temp
    M140 S{BED_TEMP} ; set bed temp
    G28
    TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={BED_TEMP - 10} MAXIMUM={BED_TEMP + 10}
    SCREWS_TILT_CALCULATE MAX_DEVIATION=0.1  # DIRECTION=CCW
    TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={BED_TEMP - 5} MAXIMUM={BED_TEMP + 5}
    BED_MESH_CALIBRATE
    TEMPERATURE_WAIT SENSOR=heater_bed MINIMUM={BED_TEMP - 1} MAXIMUM={BED_TEMP + 5}
    TEMPERATURE_WAIT SENSOR=extruder MINIMUM={EXTRUDER_TEMP - 1} MAXIMUM={EXTRUDER_TEMP + 5}
